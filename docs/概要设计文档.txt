1. 总体架构
   - 分层：UI 层（Qt Widgets/QtCharts）→ 业务服务层（设备管理、采集、告警、配置、MQTT、AI 扩展）→ 数据持久层（SQLite、缓存队列）。
   - 进程：主进程由 systemd 管理，单进程内多线程（UI 线程、采集线程、MQTT 线程、AI 线程）。
   - 通信：信号槽在 UI 与后台线程间传递状态与数据；MQTT 客户端独立线程连接云端。

2. 模块划分
   2.1 设备管理模块
       - 功能：扫描/添加/删除/分组、在线状态维护、基础信息存储。
       - 输入：串口参数、Modbus 地址段、手工导入列表。
       - 输出：设备列表与状态事件。
   2.2 数据采集模块
       - 功能：周期轮询、数据解析、异常检测。
       - 输入：设备与寄存器配置、采样周期。
       - 输出：实时数据、通信状态、异常事件。
   2.3 可视化模块
       - 功能：表格展示、曲线趋势、状态高亮。
       - 输入：实时数据、告警状态。
       - 输出：UI 组件更新、历史查询结果。
   2.4 告警模块
       - 功能：阈值/通信异常检测、确认、消音、历史记录。
       - 输入：采集数据、通信结果、阈值配置。
       - 输出：告警事件、状态变更、历史数据。
   2.5 配置管理模块
       - 功能：采样周期/阈值/设备参数配置，下发与回读校验。
       - 输入：UI 或平台配置请求。
       - 输出：设备写入结果、校验反馈。
   2.6 MQTT 联动模块
       - 功能：遥测上报、指令接收与执行、断网缓存补传。
       - 输入：实时数据、告警、控制指令。
       - 输出：MQTT 消息、执行回执。
   2.7 AI 扩展模块（可选）
       - 功能：调用 OpenCV/YOLO，生成高级告警或标记。
       - 输入：图像/数据流、配置触发条件。
       - 输出：AI 结果、联动告警与 UI。
   2.8 数据持久化模块
       - 功能：SQLite 存储实时数据、告警、配置、缓存队列。
       - 输入：采集数据、告警、配置、补传队列。
       - 输出：查询结果、缓存重传数据。

3. 数据流
   - 采集线程从设备读取 → 写入实时数据表 → 触发告警模块判断 → UI 展示与 MQTT 上报。
   - 告警状态变化写入告警表 → UI 高亮/消息提示 → 可选择确认/消音。
   - MQTT 指令下发 → 配置管理或控制执行 → 回读校验/执行结果 → 回执上报。
   - 断网时 MQTT 模块写入缓存队列；恢复后按时间顺序补传。

4. 关键技术选型
   - Qt Widgets/QtCharts：桌面 UI 与曲线展示。
   - QThread + 信号槽：线程隔离采集与 UI。
   - Modbus RTU：libmodbus 或自研帧解析。
   - MQTT：paho-mqtt-c/Qt MQTT，QoS1。
   - SQLite：轻量本地存储，支持事务。
   - systemd：开机自启、故障重启、日志收集。

5. 配置与部署
   - 配置文件：串口/Modbus 参数、采样周期、MQTT 连接、阈值策略、AI 服务地址。
   - 部署：CMake 构建，systemd service 安装；日志目录与数据库路径可配置。

6. 接口与协议概要
   - MQTT 主题示例：
       * 遥测上报：/site/{deviceId}/telemetry
       * 告警上报：/site/{deviceId}/alarm
       * 控制指令：/site/{deviceId}/command
       * 回执：/site/{deviceId}/ack
   - AI 接口：预留 HTTP/本地管道，输入图像或数据帧，输出检测结果 JSON。

7. 异常与恢复
   - 采集失败：重试与退避；连续失败标记设备离线并触发通信告警。
   - MQTT 断线：本地缓存，重连后补传。
   - 配置下发失败：重试 N 次，仍失败则记录告警。

8. 日志与监控
   - 分类：运行日志、通信日志、告警日志。
   - 内容：时间、线程、设备、操作、结果、错误码。
   - 机制：按日期滚动，支持日志级别过滤。
