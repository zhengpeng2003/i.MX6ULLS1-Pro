1. 线程与进程设计
   - 主线程：Qt UI 渲染与事件分发。
   - 采集线程池：按设备或分组分配 QThread，循环执行轮询任务。
   - MQTT 线程：独立连接与重连管理。
   - AI 线程（可选）：异步推理，结果通过信号槽回传。
   - 日志/持久化：采用异步队列，批量写 SQLite。

2. 类与模块职责（示例命名）
   2.1 DeviceManager
       - 保存设备与分组模型；提供扫描/添加/删除/更新接口。
       - 维护在线状态（心跳或采集结果驱动）。
   2.2 ModbusClient
       - 封装串口参数、连接、读写功能码；支持超时与重试。
       - 提供同步读写接口，由采集任务调用。
   2.3 PollingScheduler
       - 读取配置生成 PollingTask 队列；基于采样周期触发。
       - 动态调整周期与任务启停。
   2.4 PollingTask
       - 针对单设备/寄存器集执行读操作，解析为键值数据。
       - 将结果提交给 DataPipeline。
   2.5 DataPipeline
       - 负责数据校验、单位换算、异常检测（超限/通信失败）。
       - 将实时数据写入缓存与数据库，并发出 UI/MQTT 事件。
   2.6 AlarmService
       - 基于阈值策略与通信状态生成告警；维护告警生命周期（触发、确认、消音、恢复）。
       - 写入告警表，并向 UI/MQTT 广播状态。
   2.7 ConfigService
       - 统一管理采样周期、阈值、设备参数；提供下发与回读校验。
       - 支持配置导入导出（JSON/INI）。
   2.8 MqttClient
       - 主题与 payload 组装，上报遥测/告警；接收 command/ack。
       - 断线重连，缓存补传队列管理。
   2.9 AiAdapter（可选）
       - 封装 HTTP/本地调用；结果标准化输出。
   2.10 Persistence
       - SQLite 连接池、表结构初始化、事务封装。
       - 提供数据/告警/配置的查询与写入接口。

3. 核心流程
   3.1 采集流程
       - PollingScheduler 根据周期触发 PollingTask。
       - PollingTask 通过 ModbusClient 读取寄存器并解析。
       - DataPipeline 校验与单位处理 → 写入实时表 → 发布 UI 更新 → 触发 AlarmService。
   3.2 告警流程
       - AlarmService 比对阈值与通信状态，生成告警事件。
       - 告警状态广播给 UI 和 MqttClient；写入告警表与历史。
       - 确认/消音操作更新告警状态，并同步云端。
   3.3 配置流程
       - UI 或云指令触发 ConfigService 更新配置。
       - ConfigService 下发至设备并回读校验，失败则重试并记录告警。
   3.4 MQTT 流程
       - 数据/告警事件交给 MqttClient，上报到云端。
       - 接收 command → 分发到 ConfigService 或控制执行 → 反馈 ack。
       - 断网时将待上报消息写入缓存表，重连后按时间排序补传。
   3.5 AI 流程（可选）
       - 定时或事件触发采集图像/数据送 AiAdapter。
       - 结果映射到告警等级或 UI 标记，存档并可上报云端。

4. 配置项
   - 串口：设备文件、波特率、数据位、校验位、停止位、超时。
   - Modbus：设备地址、寄存器区间、功能码、数据类型/缩放系数。
   - 采样：周期、批量读写开关、重试次数、超时、分组优先级。
   - 告警：阈值上下限、滞后策略、告警级别、消音时长。
   - MQTT：broker 地址、端口、用户名密码、QoS、遗嘱、重连间隔。
   - AI：服务地址、模型类型、推理周期、置信度阈值。
   - 日志/数据库：文件路径、滚动策略、最大文件大小、数据库路径。

5. 线程安全与同步
   - 数据模型通过读写锁保护；UI 更新在主线程执行。
   - MQTT 缓存队列采用线程安全队列；批量入库使用互斥或事务隔离。
   - 配置更新通过信号槽广播，确保采集线程能够热更新配置。

6. 错误处理与重试
   - Modbus 读写失败：指数退避重试，超阈值后标记通信异常。
   - 配置下发失败：重试 N 次后记录告警。
   - MQTT 发送失败：写入缓存表；重连后批量发送并标记状态。

7. 日志与监控细节
   - 关键事件：设备上下线、采集失败、告警状态变化、配置下发结果、MQTT 连接状态。
   - 日志等级：DEBUG/INFO/WARN/ERROR，可配置。
   - 性能统计：采集耗时、发送耗时、补传队列长度。

8. UI 交互要点
   - 设备列表：在线状态颜色标记；分组树/表格。
   - 实时数据：表格 + 曲线；支持时间窗口切换。
   - 告警面板：当前告警与历史查询，提供确认/消音操作。
   - 配置界面：采样周期、阈值、MQTT 连接、串口参数。
   - 日志/状态栏：显示通信错误、MQTT 连接状态、补传进度。

9. 部署与运行
   - CMake 构建，生成可执行文件与资源（.qrc）。
   - systemd service：Restart=on-failure，EnvironmentFile 载入配置路径。
   - 数据库迁移：首次启动自动建表；升级时检测版本并迁移。
