1. 项目背景与目标
   1.1 背景：在 i.MX6ULL 嵌入式 Linux 平台上，为工业现场 RS485/Modbus RTU 设备提供统一的接入、监控、告警与配置能力，并通过 MQTT 连接云平台实现物联网联动。
   1.2 目标：
       - 支持 Modbus 设备快速扫描、添加、分组与状态管理。
       - 提供实时采集、可视化监控、告警管理与参数配置能力。
       - 与云平台进行遥测上报与控制指令联动，支持断网缓存与补传。
       - 采用多线程与 systemd 守护提升稳定性，预留 AI 扩展接口。

2. 范围与角色
   2.1 范围：上位机 Qt Widgets 客户端、后台采集与存储服务、MQTT 通信与 AI 扩展接口。
   2.2 角色：
       - 运维工程师：设备接入、监控、告警处理、参数配置。
       - 平台管理员：云端策略、指令下发与数据接入。
       - 系统集成商：AI 扩展与二次开发。

3. 业务流程概述
   3.1 设备接入：扫描 → 添加 → 分组 → 状态显示。
   3.2 数据采集：按周期轮询 → 数据解析 → 存储 → 可视化展示。
   3.3 告警处理：阈值/通信异常检测 → 界面高亮 → 确认/消音 → 记录历史。
   3.4 参数配置：设置采样周期、阈值与设备参数 → 下发 → 回读校验。
   3.5 云联动：MQTT 上报遥测 → 接收指令 → 执行控制 → 离线缓存补传。
   3.6 AI 扩展：调用 OpenCV/YOLO → 分析结果回写告警或界面联动。

4. 功能性需求
   4.1 设备管理
       - Modbus 设备扫描与添加，支持手工与批量导入。
       - 在线/离线状态实时更新。
       - 设备分组、基础信息维护（名称、地址、波特率、寄存器定义模板）。
   4.2 实时监控与可视化
       - 周期轮询采集（周期可配置）。
       - 表格展示实时数据，QtCharts 曲线/趋势图。
       - 状态异常高亮，通信错误提示。
   4.3 告警管理
       - 阈值告警与通信异常告警。
       - 告警确认、消音、恢复标记。
       - 历史告警查询（按时间、设备、级别过滤）。
   4.4 参数配置
       - 采样周期、告警阈值、设备参数统一配置。
       - 参数下发与回读校验，校验失败重试与记录。
   4.5 平台联动
       - MQTT 上报遥测数据，支持 QoS1。
       - 接收控制指令并执行，结果回执。
       - 断网数据本地缓存，网络恢复后自动补传。
   4.6 智能扩展（可选）
       - 接入 OpenCV/YOLO 推理服务。
       - AI 结果与告警、界面联动，不影响主流程。

5. 非功能性需求
   5.1 性能：单台设备采集周期最小 1s，支撑 100 台设备并发轮询（可按硬件调优）。
   5.2 可靠性：systemd 守护自启动与重启；异常日志完整记录。
   5.3 可用性：UI 不卡顿，数据刷新的 UI 线程与采集线程隔离。
   5.4 可维护性：模块化设计，配置可导入/导出，日志与数据存放路径可配置。
   5.5 安全：MQTT 支持用户名/密码；本地配置与数据库访问需权限控制（如文件权限）。

6. 运行环境与依赖
   - 硬件：i.MX6ULL + RS485 接口。
   - OS：Embedded Linux，systemd。
   - 开发框架：Qt Widgets/QtCharts，C++，QThread/信号槽。
   - 通信：Modbus RTU（RS485）、MQTT。
   - 数据库：SQLite。
   - 可选：OpenCV/YOLO，HTTP/Grafana 对接。

7. 接口需求
   7.1 Modbus：支持常用功能码读写保持寄存器/线圈，波特率与奇偶可配置。
   7.2 MQTT：主题规范（如 /site/{deviceId}/telemetry），支持指令主题与状态回执。
   7.3 AI：推理请求/响应接口留空实现，可通过 HTTP/本地进程调用。

8. 数据与存储
   - 实时数据、历史数据、告警、配置存储于 SQLite。
   - 支持离线缓存队列与重传标记。

9. 验收标准
   - 按需求完成功能点并通过集成测试。
   - 100 台设备场景下稳定运行 24h 无崩溃。
   - MQTT 断网后恢复可自动补传数据，无丢失。
   - 告警链路全闭环：触发、显示、确认/消音、恢复、历史查询。

10. 交付物
    - 源码、构建脚本、systemd 配置。
    - 需求/设计/数据库文档，操作手册与日志规范。

11. 模块接入选型参考
    需要 RS485（Modbus RTU）的模块：
    工业温湿度变送器
    气体传感器（CO / CH4 / H2S / NH3 / O2 等，Modbus 型）
    粉尘、CO2、噪声、光照等环境监测仪
    数字量输入模块（DI，干接点、按钮、限位）
    继电器输出模块（DO，用于蜂鸣器、风机、电磁阀）
    DI + DO 组合 IO 模块
    模拟量输入模块（4–20mA / 0–10V，用来接各种工业变送器）
    模拟量输出模块（4–20mA / 0–10V，用于控制阀门、变频器）
    单相 / 三相电能表
    变频器、电机驱动器
    工业称重模块
    远距离分布式设备（距离 > 5–10 米的）

    不需要 RS485（直接接板子）的模块：
    LED 指示灯
    蜂鸣器
    本地按键、旋钮
    本地小屏（OLED / LCD）
    触摸屏
    摄像头
    本地 RFID 模块（贴在板子旁边的）
    扫码枪（USB 或 UART）
    本地传感器模块（<1 米，非工业级）
    调试用模块

    可选是否用 RS485（看距离和环境）：
    RFID 读卡器（远距离用 RS485，近距离用 UART/USB）
    条码/二维码模块
    本地 HMI 面板
    多路串口/扩展模块
    简单温湿度模块（实验室可不用，现场建议用）

    一句话帮你记住：
    凡是“像工业仪表、分散在现场、要长期稳定跑”的 → 选 RS485
    凡是“贴在板子旁边、做交互或显示”的 → 不用 RS485
